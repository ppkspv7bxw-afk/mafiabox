<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Play</title>
</head>
<body style="font-family: system-ui, sans-serif; padding: 24px;">
  <h1>๐ฑ Play</h1>

  <div style="margin: 12px 0; padding: 12px; border: 1px solid #ddd; border-radius: 10px;">
    <div><strong>ุญุงูุฉ ุงูุงุชุตุงู:</strong> <span id="conn">ุฌุงุฑู ุงูุงุชุตุงูโฆ</span></div>
    <div style="margin-top: 8px;"><strong>ุงูุญุงูุฉ:</strong> <span id="status">โ</span></div>
  </div>

  <label>ููุฏ ุงูุบุฑูุฉ</label><br/>
  <input id="room" placeholder="ูุซุงู: ABCD" style="padding:10px; width: 220px; border-radius: 10px; border:1px solid #ccc;" />
  <br/><br/>

  <label>ุงุณูู</label><br/>
  <input id="name" placeholder="ุงุณู ุงููุงุนุจ" style="padding:10px; width: 220px; border-radius: 10px; border:1px solid #ccc;" />
  <br/><br/>

  <button id="join" disabled style="padding: 10px 14px; border-radius: 10px;">
    ุฏุฎูู
  </button>

  <p style="margin-top: 20px;"><a href="/">ุฑุฌูุน</a></p>

  <script src="https://jackbox-server-pwtr.onrender.com/socket.io/socket.io.js"></script>
  <script>
    const SERVER_URL = "https://jackbox-server-pwtr.onrender.com";

    const connEl = document.getElementById("conn");
    const statusEl = document.getElementById("status");
    const roomEl = document.getElementById("room");
    const nameEl = document.getElementById("name");
    const joinBtn = document.getElementById("join");

    const socket = io(SERVER_URL, {
      transports: ["websocket", "polling"]
    });

    function setConn(text) { connEl.textContent = text; }
    function setStatus(text) { statusEl.textContent = text; }

    socket.on("connect", () => {
      setConn("ูุชุตู โ");
      joinBtn.disabled = false;
      setStatus("ุงูุชุจ ููุฏ ุงูุบุฑูุฉ ูุงุณูู");
    });

    socket.on("disconnect", () => {
      setConn("ุบูุฑ ูุชุตู โ");
      joinBtn.disabled = true;
      setStatus("ุงููุทุน ุงูุงุชุตุงู");
    });

    socket.on("connect_error", (err) => {
      setConn("ูุดู ุงูุงุชุตุงู โ");
      joinBtn.disabled = true;
      alert("ูุดู ุงูุงุชุตุงู ุจุงูุณูุฑูุฑ: " + (err?.message || err));
      console.log("connect_error:", err);
    });

    joinBtn.onclick = () => {
      const roomCode = (roomEl.value || "").trim().toUpperCase();
      const name = (nameEl.value || "").trim();

      if (!roomCode || !name) {
        alert("ุงูุชุจ ููุฏ ุงูุบุฑูุฉ ูุงุณูู");
        return;
      }

      if (!socket.connected) {
        alert("ุงูุณูุฑูุฑ ุบูุฑ ูุชุตู. ุญุงูู ูุฑุฉ ุซุงููุฉ.");
        return;
      }

      setStatus("ุฌุงุฑู ูุญุงููุฉ ุงูุฏุฎููโฆ");
      socket.emit("player:join", { roomCode, name });
    };

    // ูู ุฏุฎูุช ููุฏ ุบูุท ุงูุณูุฑูุฑ ุจูุฑุณู room:error
    socket.on("room:error", ({ message }) => {
      setStatus("ูุดู ุงูุฏุฎูู");
      alert(message || "ุงูุบุฑูุฉ ุบูุฑ ููุฌูุฏุฉ");
    });

    // ูู ุงูุบุฑูุฉ ููุฌูุฏุฉุ ุงูุณูุฑูุฑ ุจูุฑุณู room:state (ููุฌููุน)
    socket.on("room:state", ({ roomCode, players }) => {
      // ูุฐุง ูุนูู ุงูุบุฑูุฉ ููุฌูุฏุฉ ูุงูุงุชุตุงู ุดุบุงู
      setStatus(`ุชู ุงูุงุชุตุงู ุจุงูุบุฑูุฉ ${roomCode} โ (ุนุฏุฏ ุงููุงุนุจูู: ${(players || []).length})`);
    });
  </script>
</body>
</html>